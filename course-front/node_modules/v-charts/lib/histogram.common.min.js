"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var constants=require('./constants'),utils=require('./utils'),utilsLite=require("utils-lite");require("echarts/lib/chart/bar");var Core=_interopDefault(require('./core')),defineProperty=function(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e},_extends=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var t=arguments[i];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},VALUE_AXIS_OPACITY=.5;function getBarDimAxis(e){var i=e.innerRows,t=e.dimAxisName,a=e.dimension,r=e.axisVisible,n=e.dimAxisType,s=e.dims;return a.map(function(e){return{type:"category",name:t,nameLocation:"middle",nameGap:22,data:"value"===n?getValueAxisData(s):i.map(function(i){return i[e]}),axisLabel:{formatter:function(e){return String(e)}},show:r}})}function getValueAxisData(e){for(var i=Math.max.apply(null,e),t=[],a=Math.min.apply(null,e);a<=i;a++)t.push(a);return t}function getBarMeaAxis(e){for(var i=e.meaAxisName,t=e.meaAxisType,a=e.axisVisible,r=e.digit,n=e.scale,s=e.min,l=e.max,o={type:"value",axisTick:{show:!1},show:a},u=[],m=function(e){t[e]?u[e]=_extends({},o,{axisLabel:{formatter:function(i){return utils.getFormated(i,t[e],r)}}}):u[e]=_extends({},o),u[e].name=i[e]||"",u[e].scale=n[e]||!1,u[e].min=s[e]||null,u[e].max=l[e]||null},c=0;c<2;c++)m(c);return u}function getBarTooltip(e){var i=e.axisSite,t=e.isHistogram,a=e.meaAxisType,r=e.digit,n=e.labelMap,s=t?i.right||[]:i.top||[];return n&&(s=s.map(function(e){return void 0===n[e]?e:n[e]})),{trigger:"axis",formatter:function(e){var i=[];return i.push(e[0].name+"<br>"),e.forEach(function(e){var t=e.seriesName,n=~s.indexOf(t)?a[1]:a[0];i.push(constants.itemPoint(e.color)),i.push(t+": "),i.push(utils.getFormated(e.value,n,r)),i.push("<br>")}),i.join("")}}}function getValueData(e,i){for(var t=Math.max.apply(null,i),a=[],r=Math.min.apply(null,i);r<=t;r++){var n=i.indexOf(r);~n?a.push(e[n]):a.push(null)}return a}function getBarSeries(e){var i,t=e.innerRows,a=e.metrics,r=e.stack,n=e.axisSite,s=e.isHistogram,l=e.labelMap,o=e.itemStyle,u=e.label,m=e.showLine,c=void 0===m?[]:m,d=e.dimAxisType,p=e.barGap,x=e.opacity,f=e.dims,g={},v=s?n.right||[]:n.top||[],y=s?"yAxisIndex":"xAxisIndex",b=r&&utils.getStackMap(r);return a.forEach(function(e){g[e]=[]}),t.forEach(function(e){a.forEach(function(i){g[i].push(e[i])})}),!!(i=Object.keys(g).map(function(e,i){var t="value"===d?getValueData(g[e],f):g[e],a=defineProperty({name:null!=l[e]?l[e]:e,type:~c.indexOf(e)?"line":"bar",data:t},y,~v.indexOf(e)?"1":"0");r&&b[e]&&(a.stack=b[e]),u&&(a.label=u),o&&(a.itemStyle=o);var n=x||utilsLite.get(a,"itemStyle.normal.opacity");return"value"===d&&(a.barGap=p,a.barCategoryGap="1%",null==n&&(n=VALUE_AXIS_OPACITY)),null!=n&&utilsLite.set(a,"itemStyle.normal.opacity",n),a})).length&&i}function getLegend(e){var i=e.metrics,t=e.labelMap,a=e.legendName;return a||t?{data:t?i.map(function(e){return null==t[e]?e:t[e]}):i,formatter:function(e){return null!=a[e]?a[e]:e}}:{data:i}}function getDims(e,i){return e.map(function(e){return e[i[0]]})}var histogram=function(e,i,t,a){var r=utilsLite.cloneDeep(i),n=t.axisSite,s=void 0===n?{}:n,l=t.dimension,o=void 0===l?[e[0]]:l,u=t.stack,m=void 0===u?{}:u,c=t.axisVisible,d=void 0===c||c,p=t.digit,x=void 0===p?2:p,f=t.dataOrder,g=void 0!==f&&f,v=t.scale,y=void 0===v?[!1,!1]:v,b=t.min,h=void 0===b?[null,null]:b,A=t.max,S=void 0===A?[null,null]:A,T=t.labelMap,L=void 0===T?{}:T,M=t.legendName,V=void 0===M?{}:M,w=t.label,O=t.itemStyle,D=t.showLine,N=t.barGap,_=void 0===N?"-100%":N,B=t.opacity;if(g){var k=g.label,P=g.order;k&&P?r.sort(function(e,i){return"desc"===P?e[k]-i[k]:i[k]-e[k]}):console.warn("Need to provide name and order parameters")}var j=a.tooltipVisible,E=a.legendVisible,G=e.slice();s.left&&s.right?G=s.left.concat(s.right):s.left&&!s.right?G=s.left:t.metrics?G=t.metrics:G.splice(e.indexOf(o[0]),1);var H=t.yAxisType||["normal","normal"],I=t.xAxisType||"category",q=t.yAxisName||[],C=t.xAxisName||"",R=getDims(r,o),F=E&&getLegend({metrics:G,labelMap:L,legendName:V}),U=getBarDimAxis({innerRows:r,dimAxisName:C,dimension:o,axisVisible:d,dimAxisType:I,dims:R});return{legend:F,yAxis:getBarMeaAxis({meaAxisName:q,meaAxisType:H,axisVisible:d,digit:x,scale:y,min:h,max:S}),series:getBarSeries({innerRows:r,metrics:G,stack:m,axisSite:s,isHistogram:!0,labelMap:L,itemStyle:O,label:w,showLine:D,dimAxisType:I,dimension:o,barGap:_,opacity:B,dims:R}),xAxis:U,tooltip:j&&getBarTooltip({axisSite:s,isHistogram:!0,meaAxisType:H,digit:x,labelMap:L})}},index=_extends({},Core,{name:"VeHistogram",data:function(){return this.chartHandler=histogram,{}}});module.exports=index;
