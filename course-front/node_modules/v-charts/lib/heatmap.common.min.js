"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var constants=require('./constants'),utils=require('./utils'),echarts=_interopDefault(require("echarts/lib/echarts"));require("echarts/lib/chart/heatmap"),require("echarts/lib/component/visualMap"),require("echarts/extension/bmap/bmap"),require("echarts/lib/chart/map");var Core=_interopDefault(require('./core')),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},toArray=function(e){return Array.isArray(e)?e:Array.from(e)};function getAxisList(e,t){var i=[];return e.forEach(function(e){~i.indexOf(e[t])||i.push(e[t])}),i}function getData(e){var t=e.rows,i=e.innerXAxisList,r=e.innerYAxisList,n=e.xDim,a=e.yDim,s=e.metrics,o=e.type,c=e.extraMetrics;return"cartesian"===o?t.map(function(e){var t=i.indexOf(e[n]),o=r.indexOf(e[a]),p=s?e[s]:1,u=c.map(function(t){return e[t]||"-"});return{value:[t,o,p].concat(u)}}):t.map(function(e){var t=s?e[s]:1;return{value:[e[n],e[a],t]}})}function getAxis(e,t){return{type:"category",data:e,name:t,nameLocation:"end",splitArea:{show:!0}}}function getVisualMap(e){var t=e.innerMin,i=e.innerMax,r=e.type,n=e.heatColor,a=e.series,s={min:t,max:i,calculable:!0},o=null;return"map"===r?(o={orient:"vertical",left:0,bottom:0,inRange:{color:n||constants.HEAT_MAP_COLOR}},a[0].data.length||(o.show=!1)):o="bmap"===r||"amap"===r?{show:!1,orient:"vertical",left:0,bottom:0,inRange:{color:n||constants.HEAT_BMAP_COLOR}}:{orient:"horizontal",left:"center",bottom:10,dimension:2,inRange:n&&{color:n}},_extends(s,o)}function getSeries(e){return[{type:"heatmap",data:e.chartData}]}function getTooltip(e){var t=e.dataType,i=e.innerXAxisList,r=e.innerYAxisList,n=e.digit,a=e.extraMetrics,s=e.metrics;return{trigger:"item",formatter:function(e){var o=e.color,c=toArray(e.data.value),p=c[0],u=c[1],m=c[2],l=c.slice(3),x=[];return x.push(i[p]+" ~ "+r[u]+"<br>"),a.forEach(function(e,t){x.push(e+": "+l[t]+"<br>")}),x.push(constants.itemPoint(o)+" "+s+": "+utils.getFormated(m,t,n)+"<br>"),x.join("")}}}var heatmap$1=function(e,t,i,r){var n=i.type,a=void 0===n?"cartesian":n,s=i.xAxisList,o=i.yAxisList,c=i.dimension,p=void 0===c?[e[0],e[1]]:c,u=i.metrics,m=void 0===u?e[2]:u,l=i.dataType,x=void 0===l?"normal":l,d=i.min,f=i.max,h=i.digit,g=i.bmap,v=i.amap,y=i.geo,A=i.key,b=i.v,M=void 0===b?"2.0":b,L=i.position,_=i.positionJsonLink,D=i.beforeRegisterMap,O=i.pointSize,S=void 0===O?10:O,R=i.blurSize,q=void 0===R?5:R,w=i.heatColor,z=i.yAxisName,C=i.xAxisName,T=i.beforeRegisterMapOnce,P=i.mapURLProfix,j=void 0===P?"https://unpkg.com/echarts@3.6.2/map/json/":P,E=i.specialAreas,k=void 0===E?{}:E,H=r.tooltipVisible,V=s,X=o,Y=[],J=[],N=p.concat([m]);e.forEach(function(e){~N.indexOf(e)||J.push(e)}),"cartesian"===a?(V&&V.length||(V=getAxisList(t,p[0])),X&&X.length||(X=getAxisList(t,p[1])),Y=getData({rows:t,innerXAxisList:V,innerYAxisList:X,xDim:p[0],yDim:p[1],metrics:m,type:a,extraMetrics:J})):Y=getData({rows:t,xDim:p[0],yDim:p[1],metrics:m,type:a,extraMetrics:J});var B=m?t.map(function(e){return e[m]}):[0,5];B.length||(B=[0]);var U=d||Math.min.apply(null,B),$=f||Math.max.apply(null,B),F=getAxis(V,C),G=getAxis(X,z),I=getSeries({chartData:Y}),K=getVisualMap({innerMin:U,innerMax:$,type:a,heatColor:w,series:I}),Q=H&&getTooltip({dataType:x,innerXAxisList:V,innerYAxisList:X,digit:h,extraMetrics:J,metrics:m}),W={visualMap:K,series:I};return"bmap"===a?(_extends(W.series[0],{coordinateSystem:"bmap",pointSize:S,blurSize:q}),utils.getBmap(A,M).then(function(e){return _extends({bmap:g},W)})):"map"===a?(W.series[0].coordinateSystem="geo",utils.getMapJSON({position:L,positionJsonLink:_,beforeRegisterMapOnce:T,mapURLProfix:j}).then(function(e){var t=_extends({map:L},y);return D&&(e=D(e)),echarts.registerMap(L,e,k),_extends({geo:t},W)})):"amap"===a?(_extends(W.series[0],{coordinateSystem:"amap",pointSize:S,blurSize:q}),utils.getAmap(A,M).then(function(e){return _extends({amap:v},W)})):_extends({xAxis:F,yAxis:G,tooltip:Q},W)},index=_extends({},Core,{name:"VeHeatmap",data:function(){return this.chartHandler=heatmap$1,{}}});module.exports=index;
