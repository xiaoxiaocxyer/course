"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var constants=require('./constants'),utils=require('./utils');require("echarts/lib/chart/funnel");var Core=_interopDefault(require('./core'));function getFunnelTooltip(e,n){return{trigger:"item",formatter:function(t){var r=[];return r.push(constants.itemPoint(t.color)),r.push(t.name+": "+utils.getFormated(t.data.realValue,e,n)),r.join("")}}}function getFunnelLegend(e){var n=e.data,t=e.legendName;return{data:n,formatter:function(e){return null!=t[e]?t[e]:e}}}function getFunnelSeries(e){var n=e.dimension,t=e.metrics,r=e.rows,i=e.sequence,l=e.ascending,a=e.label,u=e.labelLine,o=e.itemStyle,s=e.filterZero,c=e.useDefaultOrder,d={type:"funnel"},f=r.sort(function(e,t){return i.indexOf(e[n])-i.indexOf(t[n])});s&&(f=f.filter(function(e){return e[t]}));var m=!1;f.some(function(e,n){if(n&&e[t]>f[n-1][t])return m=!0,!0});var g=100/f.length;return d.data=m&&!c?f.slice().reverse().map(function(e,r){return{name:e[n],value:(r+1)*g,realValue:e[t]}}):f.map(function(e){return{name:e[n],value:e[t],realValue:e[t]}}),l&&(d.sort="ascending"),a&&(d.label=a),u&&(d.labelLine=u),o&&(d.itemStyle=o),d}var funnel$1=function(e,n,t,r){var i=e.slice(),l=n.slice(),a=t.dataType,u=void 0===a?"normal":a,o=t.dimension,s=void 0===o?i[0]:o,c=t.sequence,d=void 0===c?l.map(function(e){return e[s]}):c,f=t.digit,m=void 0===f?2:f,g=t.ascending,v=t.label,p=t.labelLine,b=t.legendName,h=void 0===b?{}:b,y=t.itemStyle,O=t.filterZero,x=t.useDefaultOrder,F=r.tooltipVisible,q=r.legendVisible,L=void 0;if(t.metrics)L=t.metrics;else{var S=i.slice();S.splice(i.indexOf(s),1),L=S[0]}return{tooltip:F&&getFunnelTooltip(u,m),legend:q&&getFunnelLegend({data:d,legendName:h}),series:getFunnelSeries({dimension:s,metrics:L,rows:l,sequence:d,ascending:g,label:v,labelLine:p,itemStyle:y,filterZero:O,useDefaultOrder:x})}},_extends=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},index=_extends({},Core,{name:"VeFunnel",data:function(){return this.chartHandler=funnel$1,{}}});module.exports=index;
