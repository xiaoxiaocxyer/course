"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var utils=require('./utils');require("echarts/lib/chart/bar");var Core=_interopDefault(require('./core')),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e};function getWaterfallTooltip(e,t){return{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(a){var i=a[1];return[i.name+"<br/>"+i.seriesName+" :",""+utils.getFormated(i.value,e,t)].join("")}}}function getWaterfallXAxis(e){var t=e.dimension,a=e.rows,i=e.remainStatus,r=e.totalName,n=e.remainName,o=e.labelMap,l=e.xAxisName,s=e.axisVisible,u=[r].concat(a.map(function(e){return e[t]}));return"have-remain"===i&&(u=u.concat([n])),{type:"category",name:o&&o[l]||l,splitLine:{show:!1},data:u,show:s}}function getWaterfallYAxis(e){var t=e.dataType,a=e.yAxisName,i=e.axisVisible,r=e.digit,n=e.labelMap;return{type:"value",name:null!=n[a]?n[a]:a,axisTick:{show:!1},axisLabel:{formatter:function(e){return utils.getFormated(e,t,r)}},show:i}}function getWaterfallSeries(e){var t=e.dataType,a=e.rows,i=e.metrics,r=e.totalNum,n=e.remainStatus,o=e.dataSum,l=e.digit,s={type:"bar",stack:"总量"},u=o,m=r,c=void 0,d=void 0,f=a.map(function(e){return e[i]});"have-remain"===n?(c=[0].concat(a.map(function(e){return m-=e[i]})).concat([0]),d=[r].concat(f).concat([r-o])):(c=[0].concat(a.map(function(e){return u-=e[i]})),d=[o].concat(f));var p=[];return p.push(_extends({name:"辅助",itemStyle:{normal:{opacity:0},emphasis:{opacity:0}},data:c},s)),p.push(_extends({name:"数值",label:{normal:{show:!0,position:"top",formatter:function(e){return utils.getFormated(e.value,t,l)}}},data:d},s)),p}function getWaterfallRemainStatus(e,t){return t?t>e?"have-remain":"none-remain":"not-total"}var waterfall=function(e,t,a,i){var r=a.dataType,n=void 0===r?"normal":r,o=a.dimension,l=void 0===o?e[0]:o,s=a.totalName,u=void 0===s?"总计":s,m=a.totalNum,c=a.remainName,d=void 0===c?"其他":c,f=a.xAxisName,p=void 0===f?l:f,x=a.labelMap,v=void 0===x?{}:x,g=a.axisVisible,b=void 0===g||g,y=a.digit,h=void 0===y?2:y,N=i.tooltipVisible,w=e.slice();w.splice(w.indexOf(l),1);var A=w[0],S=A,W=N&&getWaterfallTooltip(n,h),T=parseFloat(t.reduce(function(e,t){return e+Number(t[A])},0).toFixed(h)),V=getWaterfallRemainStatus(T,m);return{tooltip:W,xAxis:getWaterfallXAxis({dimension:l,rows:t,remainStatus:V,totalName:u,remainName:d,xAxisName:p,labelMap:v,axisVisible:b}),yAxis:getWaterfallYAxis({dataType:n,yAxisName:S,axisVisible:b,digit:h,labelMap:v}),series:getWaterfallSeries({dataType:n,rows:t,dimension:l,metrics:A,totalNum:m,remainStatus:V,dataSum:T,digit:h})}},index=_extends({},Core,{name:"VeWaterfall",data:function(){return this.chartHandler=waterfall,{}}});module.exports=index;
